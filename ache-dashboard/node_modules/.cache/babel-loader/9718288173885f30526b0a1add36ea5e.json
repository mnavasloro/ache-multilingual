{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) {\n    s += arguments[i].length;\n  }\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) {\n    for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) {\n      r[k] = a[j];\n    }\n  }\n\n  return r;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar state_1 = require(\"../state\");\n\nvar support_1 = require(\"../support\");\n\nvar __1 = require(\"../\");\n\nvar FilterBasedAccessor_1 = require(\"./FilterBasedAccessor\");\n\nvar find = require('lodash/find');\n\nvar compact = require('lodash/compact');\n\nvar map = require('lodash/map');\n\nvar filter = require('lodash/filter');\n\nvar omitBy = require('lodash/omitBy');\n\nvar isUndefined = require('lodash/isUndefined');\n\nvar includes = require('lodash/includes');\n\nvar NumericOptionsAccessor =\n/** @class */\nfunction (_super) {\n  __extends(NumericOptionsAccessor, _super);\n\n  function NumericOptionsAccessor(key, options) {\n    var _this = _super.call(this, key) || this;\n\n    _this.state = new state_1.ArrayState();\n    _this.options = options;\n    _this.options.options = support_1.Utils.computeOptionKeys(options.options, ['from', 'to'], 'all');\n    _this.options.fieldOptions = _this.options.fieldOptions || {\n      type: 'embedded'\n    };\n    _this.options.fieldOptions.field = _this.options.field;\n    _this.fieldContext = __1.FieldContextFactory(_this.options.fieldOptions);\n    return _this;\n  }\n\n  NumericOptionsAccessor.prototype.getDefaultOption = function () {\n    return find(this.options.options, function (it) {\n      return isUndefined(it.from) && isUndefined(it.to);\n    });\n  };\n\n  NumericOptionsAccessor.prototype.getSelectedOptions = function () {\n    var keys = this.state.getValue();\n    return filter(this.options.options, function (opt) {\n      return includes(keys, opt.key);\n    });\n  };\n\n  NumericOptionsAccessor.prototype.getSelectedOrDefaultOptions = function () {\n    var selectedOptions = this.getSelectedOptions();\n    if (selectedOptions && selectedOptions.length > 0) return selectedOptions;\n    var defaultOption = this.getDefaultOption();\n    if (defaultOption) return [defaultOption];\n    return [];\n  };\n\n  NumericOptionsAccessor.prototype.setOptions = function (titles) {\n    if (titles.length === 1) {\n      this.state = this.state.clear();\n      this.toggleOption(titles[0]);\n    } else {\n      var keys = map(filter(this.options.options, function (opt) {\n        return includes(titles, opt.title);\n      }), 'key');\n      this.state = this.state.setValue(keys);\n      this.searchkit.performSearch();\n    }\n  };\n\n  NumericOptionsAccessor.prototype.toggleOption = function (key) {\n    var option = find(this.options.options, {\n      title: key\n    });\n\n    if (option) {\n      if (option === this.getDefaultOption()) {\n        this.state = this.state.clear();\n      } else if (this.options.multiselect) {\n        this.state = this.state.toggle(option.key);\n      } else if (includes(this.state.getValue(), option.key)) {\n        this.state = this.state.clear();\n      } else {\n        this.state = this.state.setValue([option.key]);\n      }\n\n      this.searchkit.performSearch();\n    }\n  };\n\n  NumericOptionsAccessor.prototype.getBuckets = function () {\n    return filter(this.getAggregations([this.uuid, this.fieldContext.getAggregationPath(), this.key, 'buckets'], []), this.emptyOptionsFilter);\n  };\n\n  NumericOptionsAccessor.prototype.getDocCount = function () {\n    return this.getAggregations([this.uuid, this.fieldContext.getAggregationPath(), 'doc_count'], 0);\n  };\n\n  NumericOptionsAccessor.prototype.emptyOptionsFilter = function (option) {\n    return option.doc_count > 0;\n  };\n\n  NumericOptionsAccessor.prototype.buildSharedQuery = function (query) {\n    var _this = this;\n\n    var filters = this.getSelectedOptions();\n    var filterRanges = map(filters, function (filter) {\n      return _this.fieldContext.wrapFilter(__1.RangeQuery(_this.options.field, {\n        gte: filter.from,\n        lt: filter.to\n      }));\n    });\n    var selectedFilters = map(filters, function (filter) {\n      return {\n        name: _this.translate(_this.options.title),\n        value: _this.translate(filter.title),\n        id: _this.options.id,\n        remove: function remove() {\n          return _this.state = _this.state.remove(filter.key);\n        }\n      };\n    });\n\n    if (filterRanges.length > 0) {\n      query = query.addFilter(this.uuid, __1.BoolShould(filterRanges)).addSelectedFilters(selectedFilters);\n    }\n\n    return query;\n  };\n\n  NumericOptionsAccessor.prototype.getRanges = function () {\n    return compact(map(this.options.options, function (range) {\n      return omitBy({\n        key: range.title,\n        from: range.from,\n        to: range.to\n      }, isUndefined);\n    }));\n  };\n\n  NumericOptionsAccessor.prototype.buildOwnQuery = function (query) {\n    return query.setAggs(__1.FilterBucket.apply(void 0, __spreadArrays([this.uuid, query.getFiltersWithoutKeys(this.uuid)], this.fieldContext.wrapAggregations(__1.RangeBucket(this.key, this.options.field, this.getRanges())))));\n  };\n\n  return NumericOptionsAccessor;\n}(FilterBasedAccessor_1.FilterBasedAccessor);\n\nexports.NumericOptionsAccessor = NumericOptionsAccessor;","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AAUA;;AAEA,IAAMA,IAAI,GAAGC,OAAO,CAAC,aAAD,CAApB;;AACA,IAAMC,OAAO,GAAGD,OAAO,CAAC,gBAAD,CAAvB;;AACA,IAAME,GAAG,GAAGF,OAAO,CAAC,YAAD,CAAnB;;AACA,IAAMG,MAAM,GAAGH,OAAO,CAAC,eAAD,CAAtB;;AACA,IAAMI,MAAM,GAAGJ,OAAO,CAAC,eAAD,CAAtB;;AACA,IAAMK,WAAW,GAAGL,OAAO,CAAC,oBAAD,CAA3B;;AACA,IAAMM,QAAQ,GAAGN,OAAO,CAAC,iBAAD,CAAxB;;AAiBA;AAAA;AAAA;EAA4CO;;EAK1C,gCAAYC,GAAZ,EAAiBC,OAAjB,EAAwC;IAAxC,YACEC,kBAAMF,GAAN,KAAU,IADZ;;IAJAG,cAAQ,IAAIC,kBAAJ,EAAR;IAMED,KAAI,CAACF,OAAL,GAAeA,OAAf;IACAE,KAAI,CAACF,OAAL,CAAaA,OAAb,GAAuBI,gBAAMC,iBAAN,CAAwBL,OAAO,CAACA,OAAhC,EAAyC,CAAC,MAAD,EAAS,IAAT,CAAzC,EAAyD,KAAzD,CAAvB;IACAE,KAAI,CAACF,OAAL,CAAaM,YAAb,GAA4BJ,KAAI,CAACF,OAAL,CAAaM,YAAb,IAA6B;MAAEC,IAAI,EAAE;IAAR,CAAzD;IACAL,KAAI,CAACF,OAAL,CAAaM,YAAb,CAA0BE,KAA1B,GAAkCN,KAAI,CAACF,OAAL,CAAaQ,KAA/C;IACAN,KAAI,CAACO,YAAL,GAAoBC,wBAAoBR,KAAI,CAACF,OAAL,CAAaM,YAAjC,CAApB;;EACD;;EAEDK;IACE,OAAOrB,IAAI,CAAC,KAAKU,OAAL,CAAaA,OAAd,EAAuB,UAACY,EAAD,EAAG;MAAK,kBAAW,CAACA,EAAE,CAACC,IAAJ,CAAX,IAAwBjB,WAAW,CAACgB,EAAE,CAACE,EAAJ,CAAnC;IAA0C,CAAzE,CAAX;EACD,CAFD;;EAIAH;IACE,IAAMI,IAAI,GAAG,KAAKC,KAAL,CAAWC,QAAX,EAAb;IACA,OAAOvB,MAAM,CAAC,KAAKM,OAAL,CAAaA,OAAd,EAAuB,UAACkB,GAAD,EAAI;MAAK,eAAQ,CAACH,IAAD,EAAOG,GAAG,CAACnB,GAAX,CAAR;IAAuB,CAAvD,CAAb;EACD,CAHD;;EAKAY;IACE,IAAMQ,eAAe,GAAG,KAAKC,kBAAL,EAAxB;IACA,IAAID,eAAe,IAAIA,eAAe,CAACE,MAAhB,GAAyB,CAAhD,EAAmD,OAAOF,eAAP;IACnD,IAAMG,aAAa,GAAG,KAAKC,gBAAL,EAAtB;IACA,IAAID,aAAJ,EAAmB,OAAO,CAACA,aAAD,CAAP;IACnB,OAAO,EAAP;EACD,CAND;;EAQAX,wDAAWa,MAAX,EAAiB;IACf,IAAIA,MAAM,CAACH,MAAP,KAAkB,CAAtB,EAAyB;MACvB,KAAKL,KAAL,GAAa,KAAKA,KAAL,CAAWS,KAAX,EAAb;MACA,KAAKC,YAAL,CAAkBF,MAAM,CAAC,CAAD,CAAxB;IACD,CAHD,MAGO;MACL,IAAMT,IAAI,GAAQtB,GAAG,CACnBC,MAAM,CAAC,KAAKM,OAAL,CAAaA,OAAd,EAAuB,UAACkB,GAAD,EAAI;QAAK,eAAQ,CAACM,MAAD,EAASN,GAAG,CAACS,KAAb,CAAR;MAA2B,CAA3D,CADa,EAEnB,KAFmB,CAArB;MAKA,KAAKX,KAAL,GAAa,KAAKA,KAAL,CAAWY,QAAX,CAAoBb,IAApB,CAAb;MACA,KAAKc,SAAL,CAAeC,aAAf;IACD;EACF,CAbD;;EAeAnB,0DAAaZ,GAAb,EAAgB;IACd,IAAMgC,MAAM,GAAGzC,IAAI,CAAC,KAAKU,OAAL,CAAaA,OAAd,EAAuB;MAAE2B,KAAK,EAAE5B;IAAT,CAAvB,CAAnB;;IACA,IAAIgC,MAAJ,EAAY;MACV,IAAIA,MAAM,KAAK,KAAKR,gBAAL,EAAf,EAAwC;QACtC,KAAKP,KAAL,GAAa,KAAKA,KAAL,CAAWS,KAAX,EAAb;MACD,CAFD,MAEO,IAAI,KAAKzB,OAAL,CAAagC,WAAjB,EAA8B;QACnC,KAAKhB,KAAL,GAAa,KAAKA,KAAL,CAAWiB,MAAX,CAAkBF,MAAM,CAAChC,GAAzB,CAAb;MACD,CAFM,MAEA,IAAIF,QAAQ,CAAC,KAAKmB,KAAL,CAAWC,QAAX,EAAD,EAAwBc,MAAM,CAAChC,GAA/B,CAAZ,EAAiD;QACtD,KAAKiB,KAAL,GAAa,KAAKA,KAAL,CAAWS,KAAX,EAAb;MACD,CAFM,MAEA;QACL,KAAKT,KAAL,GAAa,KAAKA,KAAL,CAAWY,QAAX,CAAoB,CAACG,MAAM,CAAChC,GAAR,CAApB,CAAb;MACD;;MACD,KAAK8B,SAAL,CAAeC,aAAf;IACD;EACF,CAdD;;EAgBAnB;IACE,OAAOjB,MAAM,CACX,KAAKwC,eAAL,CACE,CAAC,KAAKC,IAAN,EAAY,KAAK1B,YAAL,CAAkB2B,kBAAlB,EAAZ,EAAoD,KAAKrC,GAAzD,EAA8D,SAA9D,CADF,EAEE,EAFF,CADW,EAKX,KAAKsC,kBALM,CAAb;EAOD,CARD;;EAUA1B;IACE,OAAO,KAAKuB,eAAL,CAAqB,CAAC,KAAKC,IAAN,EAAY,KAAK1B,YAAL,CAAkB2B,kBAAlB,EAAZ,EAAoD,WAApD,CAArB,EAAuF,CAAvF,CAAP;EACD,CAFD;;EAIAzB,gEAAmBoB,MAAnB,EAAyB;IACvB,OAAOA,MAAM,CAACO,SAAP,GAAmB,CAA1B;EACD,CAFD;;EAIA3B,8DAAiB4B,KAAjB,EAAsB;IAAtB;;IACE,IAAMC,OAAO,GAAG,KAAKpB,kBAAL,EAAhB;IACA,IAAMqB,YAAY,GAAGhD,GAAG,CAAC+C,OAAD,EAAU,UAAC9C,MAAD,EAAO;MACvC,YAAI,CAACe,YAAL,CAAkBiC,UAAlB,CACEhC,eAAWR,KAAI,CAACF,OAAL,CAAaQ,KAAxB,EAA+B;QAC7BmC,GAAG,EAAEjD,MAAM,CAACmB,IADiB;QAE7B+B,EAAE,EAAElD,MAAM,CAACoB;MAFkB,CAA/B,CADF;IAKC,CANqB,CAAxB;IAQA,IAAM+B,eAAe,GAA0BpD,GAAG,CAAC+C,OAAD,EAAU,UAAC9C,MAAD,EAAO;MAAK,OAAC;QACvEoD,IAAI,EAAE5C,KAAI,CAAC6C,SAAL,CAAe7C,KAAI,CAACF,OAAL,CAAa2B,KAA5B,CADiE;QAEvEqB,KAAK,EAAE9C,KAAI,CAAC6C,SAAL,CAAerD,MAAM,CAACiC,KAAtB,CAFgE;QAGvEsB,EAAE,EAAE/C,KAAI,CAACF,OAAL,CAAaiD,EAHsD;QAIvEC,MAAM,EAAE;UAAM,OAAChD,KAAI,CAACc,KAAL,GAAad,KAAI,CAACc,KAAL,CAAWkC,MAAX,CAAkBxD,MAAM,CAACK,GAAzB,CAAd;QAA4C;MAJa,CAAD;IAKtE,CALgD,CAAlD;;IAOA,IAAI0C,YAAY,CAACpB,MAAb,GAAsB,CAA1B,EAA6B;MAC3BkB,KAAK,GAAGA,KAAK,CACVY,SADK,CACK,KAAKhB,IADV,EACgBzB,eAAW+B,YAAX,CADhB,EAELW,kBAFK,CAEcP,eAFd,CAAR;IAGD;;IAED,OAAON,KAAP;EACD,CAxBD;;EA0BA5B;IACE,OAAOnB,OAAO,CACZC,GAAG,CAAC,KAAKO,OAAL,CAAaA,OAAd,EAAuB,UAACqD,KAAD,EAAmB;MAC3C,aAAM,CACJ;QACEtD,GAAG,EAAEsD,KAAK,CAAC1B,KADb;QAEEd,IAAI,EAAEwC,KAAK,CAACxC,IAFd;QAGEC,EAAE,EAAEuC,KAAK,CAACvC;MAHZ,CADI,EAMJlB,WANI,CAAN;IAOC,CARA,CADS,CAAd;EAYD,CAbD;;EAeAe,2DAAc4B,KAAd,EAAmB;IACjB,OAAOA,KAAK,CAACe,OAAN,CACL5C,iBAAY6C,KAAZ,CAAY,MAAZ,EAAYC,gBACV,KAAKrB,IADK,EAEVI,KAAK,CAACkB,qBAAN,CAA4B,KAAKtB,IAAjC,CAFU,GAGP,KAAK1B,YAAL,CAAkBiD,gBAAlB,CACDhD,gBAAY,KAAKX,GAAjB,EAAsB,KAAKC,OAAL,CAAaQ,KAAnC,EAA0C,KAAKmD,SAAL,EAA1C,CADC,CAHO,CAAZ,CADK,CAAP;EASD,CAVD;;EAWF;AAAC,CApID,CAA4CC,yCAA5C;;AAAaC","names":["find","require","compact","map","filter","omitBy","isUndefined","includes","__extends","key","options","_super","_this","state_1","support_1","computeOptionKeys","fieldOptions","type","field","fieldContext","__1","NumericOptionsAccessor","it","from","to","keys","state","getValue","opt","selectedOptions","getSelectedOptions","length","defaultOption","getDefaultOption","titles","clear","toggleOption","title","setValue","searchkit","performSearch","option","multiselect","toggle","getAggregations","uuid","getAggregationPath","emptyOptionsFilter","doc_count","query","filters","filterRanges","wrapFilter","gte","lt","selectedFilters","name","translate","value","id","remove","addFilter","addSelectedFilters","range","setAggs","apply","__spreadArrays","getFiltersWithoutKeys","wrapAggregations","getRanges","FilterBasedAccessor_1","exports"],"sources":["C:\\Users\\mnavas\\CODE\\SmartBIC\\ache-multilingual\\ache-dashboard\\node_modules\\searchkit\\src\\core\\accessors\\NumericOptionsAccessor.ts"],"sourcesContent":["import { ArrayState } from '../state'\nimport { Utils } from '../support'\nimport {\n  RangeQuery,\n  BoolShould,\n  RangeBucket,\n  FilterBucket,\n  SelectedFilter,\n  FieldOptions,\n  FieldContext,\n  FieldContextFactory\n} from '../'\nimport { FilterBasedAccessor } from './FilterBasedAccessor'\n\nconst find = require('lodash/find')\nconst compact = require('lodash/compact')\nconst map = require('lodash/map')\nconst filter = require('lodash/filter')\nconst omitBy = require('lodash/omitBy')\nconst isUndefined = require('lodash/isUndefined')\nconst includes = require('lodash/includes')\n\nexport interface RangeOption {\n  title: string\n  from?: number\n  to?: number\n  key?: string\n}\nexport interface NumericOptions {\n  field: string\n  title: string\n  options: Array<RangeOption>\n  multiselect?: boolean\n  id: string\n  fieldOptions?: FieldOptions\n}\n\nexport class NumericOptionsAccessor extends FilterBasedAccessor<ArrayState> {\n  state = new ArrayState()\n  options: NumericOptions\n  fieldContext: FieldContext\n\n  constructor(key, options: NumericOptions) {\n    super(key)\n    this.options = options\n    this.options.options = Utils.computeOptionKeys(options.options, ['from', 'to'], 'all')\n    this.options.fieldOptions = this.options.fieldOptions || { type: 'embedded' }\n    this.options.fieldOptions.field = this.options.field\n    this.fieldContext = FieldContextFactory(this.options.fieldOptions)\n  }\n\n  getDefaultOption() {\n    return find(this.options.options, (it) => isUndefined(it.from) && isUndefined(it.to))\n  }\n\n  getSelectedOptions() {\n    const keys = this.state.getValue()\n    return filter(this.options.options, (opt) => includes(keys, opt.key))\n  }\n\n  getSelectedOrDefaultOptions() {\n    const selectedOptions = this.getSelectedOptions()\n    if (selectedOptions && selectedOptions.length > 0) return selectedOptions\n    const defaultOption = this.getDefaultOption()\n    if (defaultOption) return [defaultOption]\n    return []\n  }\n\n  setOptions(titles) {\n    if (titles.length === 1) {\n      this.state = this.state.clear()\n      this.toggleOption(titles[0])\n    } else {\n      const keys: any = map(\n        filter(this.options.options, (opt) => includes(titles, opt.title)),\n        'key'\n      )\n\n      this.state = this.state.setValue(keys)\n      this.searchkit.performSearch()\n    }\n  }\n\n  toggleOption(key) {\n    const option = find(this.options.options, { title: key })\n    if (option) {\n      if (option === this.getDefaultOption()) {\n        this.state = this.state.clear()\n      } else if (this.options.multiselect) {\n        this.state = this.state.toggle(option.key)\n      } else if (includes(this.state.getValue(), option.key)) {\n        this.state = this.state.clear()\n      } else {\n        this.state = this.state.setValue([option.key])\n      }\n      this.searchkit.performSearch()\n    }\n  }\n\n  getBuckets() {\n    return filter(\n      this.getAggregations(\n        [this.uuid, this.fieldContext.getAggregationPath(), this.key, 'buckets'],\n        []\n      ),\n      this.emptyOptionsFilter\n    )\n  }\n\n  getDocCount() {\n    return this.getAggregations([this.uuid, this.fieldContext.getAggregationPath(), 'doc_count'], 0)\n  }\n\n  emptyOptionsFilter(option) {\n    return option.doc_count > 0\n  }\n\n  buildSharedQuery(query) {\n    const filters = this.getSelectedOptions()\n    const filterRanges = map(filters, (filter) =>\n      this.fieldContext.wrapFilter(\n        RangeQuery(this.options.field, {\n          gte: filter.from,\n          lt: filter.to\n        })\n      )\n    )\n    const selectedFilters: Array<SelectedFilter> = map(filters, (filter) => ({\n      name: this.translate(this.options.title),\n      value: this.translate(filter.title),\n      id: this.options.id,\n      remove: () => (this.state = this.state.remove(filter.key))\n    }))\n\n    if (filterRanges.length > 0) {\n      query = query\n        .addFilter(this.uuid, BoolShould(filterRanges))\n        .addSelectedFilters(selectedFilters)\n    }\n\n    return query\n  }\n\n  getRanges() {\n    return compact(\n      map(this.options.options, (range: RangeOption) =>\n        omitBy(\n          {\n            key: range.title,\n            from: range.from,\n            to: range.to\n          },\n          isUndefined\n        )\n      )\n    )\n  }\n\n  buildOwnQuery(query) {\n    return query.setAggs(\n      FilterBucket(\n        this.uuid,\n        query.getFiltersWithoutKeys(this.uuid),\n        ...this.fieldContext.wrapAggregations(\n          RangeBucket(this.key, this.options.field, this.getRanges())\n        )\n      )\n    )\n  }\n}\n"]},"metadata":{},"sourceType":"script"}