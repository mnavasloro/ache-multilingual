{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) {\n    s += arguments[i].length;\n  }\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) {\n    for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) {\n      r[k] = a[j];\n    }\n  }\n\n  return r;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar state_1 = require(\"../state\");\n\nvar query_1 = require(\"../query\");\n\nvar FilterBasedAccessor_1 = require(\"./FilterBasedAccessor\");\n\nvar assign = require('lodash/assign');\n\nvar identity = require('lodash/identity');\n\nvar DynamicRangeAccessor =\n/** @class */\nfunction (_super) {\n  __extends(DynamicRangeAccessor, _super);\n\n  function DynamicRangeAccessor(key, options) {\n    var _this = _super.call(this, key, options.id) || this;\n\n    _this.state = new state_1.ObjectState({});\n    _this.translations = DynamicRangeAccessor.translations;\n    _this.options = options;\n    _this.options.fieldOptions = _this.options.fieldOptions || {\n      type: 'embedded'\n    };\n    _this.options.fieldOptions.field = _this.options.field;\n    _this.fieldContext = query_1.FieldContextFactory(_this.options.fieldOptions);\n    _this.options.rangeFormatter = _this.options.rangeFormatter || identity;\n\n    if (options.translations) {\n      _this.translations = assign({}, _this.translations, options.translations);\n    }\n\n    return _this;\n  }\n\n  DynamicRangeAccessor.prototype.getSelectedValue = function (value) {\n    var divider = this.translate('range.divider');\n    return [this.options.rangeFormatter(value.min), divider, this.options.rangeFormatter(value.max)].join('');\n  };\n\n  DynamicRangeAccessor.prototype.buildSharedQuery = function (query) {\n    var _this = this;\n\n    if (this.state.hasValue()) {\n      var val = this.state.getValue();\n      var rangeFilter = this.fieldContext.wrapFilter(query_1.RangeQuery(this.options.field, {\n        gte: val.min,\n        lte: val.max\n      }));\n      var selectedFilter = {\n        name: this.translate(this.options.title),\n        value: this.getSelectedValue(val),\n        id: this.options.id,\n        remove: function remove() {\n          _this.state = _this.state.clear();\n        }\n      };\n      return query.addFilter(this.key, rangeFilter).addSelectedFilter(selectedFilter);\n    }\n\n    return query;\n  };\n\n  DynamicRangeAccessor.prototype.getStat = function (stat) {\n    return this.getAggregations([this.key, this.fieldContext.getAggregationPath(), this.key, stat], 0);\n  };\n\n  DynamicRangeAccessor.prototype.isDisabled = function () {\n    return this.getStat('count') === 0 || this.getStat('min') === this.getStat('max');\n  };\n\n  DynamicRangeAccessor.prototype.buildOwnQuery = function (query) {\n    var otherFilters = query.getFiltersWithoutKeys(this.key);\n    return query.setAggs(query_1.FilterBucket.apply(void 0, __spreadArrays([this.key, otherFilters], this.fieldContext.wrapAggregations(query_1.StatsMetric(this.key, this.options.field)))));\n  };\n\n  DynamicRangeAccessor.translations = {\n    'range.divider': ' - '\n  };\n  return DynamicRangeAccessor;\n}(FilterBasedAccessor_1.FilterBasedAccessor);\n\nexports.DynamicRangeAccessor = DynamicRangeAccessor;","map":{"version":3,"mappings":"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","names":["assign","require","identity","__extends","key","options","_super","id","_this","state_1","DynamicRangeAccessor","translations","fieldOptions","type","field","fieldContext","query_1","rangeFormatter","value","divider","translate","min","max","join","query","state","hasValue","val","getValue","rangeFilter","wrapFilter","gte","lte","selectedFilter","name","title","getSelectedValue","remove","clear","addFilter","addSelectedFilter","stat","getAggregations","getAggregationPath","getStat","otherFilters","getFiltersWithoutKeys","setAggs","apply","__spreadArrays","wrapAggregations","FilterBasedAccessor_1","exports"],"sources":["C:\\Users\\mnavas\\CODE\\SmartBIC\\ache-multilingual\\ache-dashboard\\node_modules\\searchkit\\src\\core\\accessors\\DynamicRangeAccessor.ts"],"sourcesContent":["import { ObjectState } from '../state'\n\nimport {\n  FilterBucket,\n  RangeQuery,\n  StatsMetric,\n  FieldOptions,\n  FieldContext,\n  FieldContextFactory\n} from '../query'\nimport { FilterBasedAccessor } from './FilterBasedAccessor'\n\nconst assign = require('lodash/assign')\nconst identity = require('lodash/identity')\n\nexport interface DynamicRangeAccessorOptions {\n  title: string\n  id: string\n  field: string\n  fieldOptions?: FieldOptions\n  rangeFormatter?: Function\n  translations?: Record<string, any>\n}\n\nexport class DynamicRangeAccessor extends FilterBasedAccessor<ObjectState> {\n  options: any\n  fieldContext: FieldContext\n  state = new ObjectState({})\n\n  static translations: any = {\n    'range.divider': ' - '\n  }\n  translations = DynamicRangeAccessor.translations\n\n  constructor(key, options: DynamicRangeAccessorOptions) {\n    super(key, options.id)\n    this.options = options\n    this.options.fieldOptions = this.options.fieldOptions || { type: 'embedded' }\n    this.options.fieldOptions.field = this.options.field\n    this.fieldContext = FieldContextFactory(this.options.fieldOptions)\n    this.options.rangeFormatter = this.options.rangeFormatter || identity\n    if (options.translations) {\n      this.translations = assign({}, this.translations, options.translations)\n    }\n  }\n\n  getSelectedValue(value) {\n    const divider = this.translate('range.divider')\n    return [\n      this.options.rangeFormatter(value.min),\n      divider,\n      this.options.rangeFormatter(value.max)\n    ].join('')\n  }\n\n  buildSharedQuery(query) {\n    if (this.state.hasValue()) {\n      const val: any = this.state.getValue()\n      const rangeFilter = this.fieldContext.wrapFilter(\n        RangeQuery(this.options.field, {\n          gte: val.min,\n          lte: val.max\n        })\n      )\n      const selectedFilter = {\n        name: this.translate(this.options.title),\n        value: this.getSelectedValue(val),\n        id: this.options.id,\n        remove: () => {\n          this.state = this.state.clear()\n        }\n      }\n\n      return query.addFilter(this.key, rangeFilter).addSelectedFilter(selectedFilter)\n    }\n\n    return query\n  }\n\n  getStat(stat) {\n    return this.getAggregations(\n      [this.key, this.fieldContext.getAggregationPath(), this.key, stat],\n      0\n    )\n  }\n\n  isDisabled() {\n    return this.getStat('count') === 0 || this.getStat('min') === this.getStat('max')\n  }\n\n  buildOwnQuery(query) {\n    const otherFilters = query.getFiltersWithoutKeys(this.key)\n\n    return query.setAggs(\n      FilterBucket(\n        this.key,\n        otherFilters,\n        ...this.fieldContext.wrapAggregations(StatsMetric(this.key, this.options.field))\n      )\n    )\n  }\n}\n"]},"metadata":{},"sourceType":"script"}